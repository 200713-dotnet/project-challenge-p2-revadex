jobs:
  
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2.3.1
      - run: dotnet build StarDex.Client/StarDex.Client.csproj
      - run: dotnet build Domain.Service/DomainService.sln
      - run: dotnet build Image.Service/ImageService.sln

  test:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2.3.1
      - run: dotnet test Domain.Service/DomainService.Testing/DomainService.Testing.csproj
      - run: dotnet test Image.Service/Image.Testing/Image.Testing.csproj

  analyze:
    needs: [build, test]
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2.3.1
      - run: git fetch --unshallow
      - run: dotnet tool install --global dotnet-sonarscanner
      - run: | # multiline value with each line ending with a newline character \n
          dotnet sonarscanner begin -o:'jpchionglo' -k:'revadexdomainservice' -d:sonar.login='${{ secrets.SONARLOGINDOMAIN }}' -d:sonar.host.url='https://sonarcloud.io/'
          dotnet build Domain.Service/DomainService.sln
          dotnet test Domain.Service/DomainService.Testing/DomainService.Testing.csproj -p:CollectCoverage=true -p:CoverletOutputFormat=opencover --logger trx
          dotnet sonarscanner end -d:sonar.login='${{ secrets.SONARLOGINDOMAIN }}'
        env: 
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - run: |
          dotnet sonarscanner begin -o:'jpchionglo' -k:'revadeximageservice' -d:sonar.login='${{ secrets.SONARLOGINIMAGE }}' -d:sonar.host.url='https://sonarcloud.io/'
          dotnet build Image.Service/ImageService.sln
          dotnet test Image.Service/Image.Testing/Image.Testing.csproj -p:CollectCoverage=true -p:CoverletOutputFormat=opencover --logger trx
          dotnet sonarscanner end -d:sonar.login='${{ secrets.SONARLOGINIMAGE }}'
        env: 
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - run: |   
          dotnet sonarscanner begin -o:'jpchionglo' -k:'revadexstardexclient' -d:sonar.login='${{ secrets.SONARLOGINCLIENT }}' -d:sonar.host.url='https://sonarcloud.io/'
          dotnet build StarDex.Client/StarDex.Client.csproj
          dotnet sonarscanner end -d:sonar.login='${{ secrets.SONARLOGINCLIENT }}'
        env: 
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        


name: cibuild

on: push

